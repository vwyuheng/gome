<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tuan-inventory" >

    <!-- 物流发货仓库信息-->	
	<resultMap id="WmsIsBeDeliveryResult" class="com.tuan.inventory.dao.data.redis.WmsIsBeDeliveryDO">
	    <result column="is_be_delivery" property="isBeDelivery" jdbcType="INTEGER" />  
	    <result column="description" property="description" jdbcType="VARCHAR" />    
	 </resultMap>
    <!-- 商品物流信息-->	
	<resultMap id="GoodsInventoryWMSResult" class="com.tuan.inventory.dao.data.redis.GoodsInventoryWMSDO">
	    <result column="id" property="id" jdbcType="BIGINT" />
	  <!--   <result column="goods_id" property="goodsId" jdbcType="BIGINT" /> -->
	    <result column="wms_goods_id" property="wmsGoodsId" jdbcType="VARCHAR" />
	     <result column="goods_supplier" property="goodsSupplier" jdbcType="VARCHAR" />
	      <result column="goods_sname" property="goodsName" jdbcType="VARCHAR" />
	    <result column="total_num" property="totalNumber" jdbcType="INTEGER" />
	    <result column="left_num" property="leftNumber" jdbcType="INTEGER" />
	    <result column="is_be_delivery" property="isBeDelivery" jdbcType="INTEGER" />   	    
	 </resultMap>
	 
	<!-- 商品配型信息-->	
	<resultMap id="GoodsSelectionResult" class="com.tuan.inventory.dao.data.redis.GoodsSelectionDO">
	    <result column="id" property="id" jdbcType="BIGINT" />
	    <result column="goods_id" property="goodsId" jdbcType="BIGINT" />
	     <result column="suppliers_id" property="suppliersId" jdbcType="BIGINT" />
	   <!--  <result column="user_id" property="userId" jdbcType="BIGINT" /> -->
	    <result column="good_type_id" property="goodTypeId" jdbcType="INTEGER" />
	    <result column="total_num" property="totalNumber" jdbcType="INTEGER" />
	    <result column="left_num" property="leftNumber" jdbcType="INTEGER" />
	     <result column="waterfloodVal" property="waterfloodVal" jdbcType="INTEGER" />
	    <result column="suppliers_sub_id" property="suppliersSubId" jdbcType="INTEGER" />
	    <result column="suppliers_inventory_id" property="suppliersInventoryId" jdbcType="INTEGER" />
	    <result column="limit_storage" property="limitStorage" jdbcType="INTEGER" />   	    
	 </resultMap>
	 	
   <!-- 商品主体库存信息-->	
	<resultMap id="GoodsInventoryResult" class="com.tuan.inventory.dao.data.redis.GoodsInventoryDO">
	    <result column="goods_id" property="goodsId" jdbcType="BIGINT" />
	    <result column="goods_wms_id" property="wmsId" jdbcType="BIGINT" />
	    <result column="good_selection_ids" property="goodsSelectionIds" jdbcType="VARCHAR" />
	    <result column="total_num" property="totalNumber" jdbcType="INTEGER" />
	    <result column="left_num" property="leftNumber" jdbcType="INTEGER" />
	    <result column="limit_storage" property="limitStorage" jdbcType="INTEGER" />
	    <result column="add_goods_selection" property="isAddGoodsSelection" jdbcType="INTEGER" />
	    <result column="direct_consumption" property="isDirectConsumption" jdbcType="INTEGER" />
	     <result column="waterflood_val" property="waterfloodVal" jdbcType="INTEGER" />
	 </resultMap>
	 
	 <!-- 分店库存信息-->	
	<resultMap id="GoodsSuppliersResult" class="com.tuan.inventory.dao.data.redis.GoodsSuppliersDO">
	    <result column="id" property="id" jdbcType="BIGINT" />
	    <result column="goods_id" property="goodsId" jdbcType="BIGINT" />
	    <!--  <result column="user_id" property="userId" jdbcType="BIGINT" /> -->
	    <result column="suppliers_id" property="suppliersId" jdbcType="INTEGER" />
	    <result column="total_num" property="totalNumber" jdbcType="INTEGER" />
	    <result column="left_num" property="leftNumber" jdbcType="INTEGER" />
	    <result column="limit_storage" property="limitStorage" jdbcType="INTEGER" />
	    <result column="waterflood_val" property="waterfloodVal" jdbcType="INTEGER" />
	 </resultMap>
	  <!-- 记录库存日志流水信息-->	
	<resultMap id="GoodsInventoryActionResult" class="com.tuan.inventory.dao.data.redis.GoodsInventoryActionDO">
	    <result column="id" property="id" jdbcType="BIGINT"/>
	    <result column="goods_id" property="goodsId" jdbcType="BIGINT" />
	    <result column="order_id" property="orderId" jdbcType="BIGINT" />
	    <result column="user_id" property="userId" jdbcType="BIGINT" />
	    <result column="type" property="businessType" jdbcType="VARCHAR" />
	    <result column="item" property="item" jdbcType="VARCHAR" />
	     <result column="create_time" property="createTime" jdbcType="INTEGER" />
	    <result column="inventory_vara" property="inventoryChange" jdbcType="VARCHAR" />
	    <result column="original_inventory" property="originalInventory" jdbcType="VARCHAR" />
	     <result column="opt_type" property="actionType" jdbcType="VARCHAR" />
	    <result column="content" property="content" jdbcType="VARCHAR" />
	    <result column="system" property="clientName" jdbcType="VARCHAR" />
	    <result column="client_ip" property="clientIp" jdbcType="VARCHAR" />
	    <result column="remark" property="remark" jdbcType="VARCHAR" />
	 </resultMap>
	
	 <!-- 根据物流码查询发货仓库信息  -->	
	<select id="selectWmsIsBeDeliveryResult" resultMap="WmsIsBeDeliveryResult"  parameterClass="java.lang.String">
	SELECT
	CASE
	wms.is_be_delivery
	WHEN 0
	THEN 'wowo'
	WHEN 1
	THEN 'shangjia'
	END is_be_delivery,
	CASE
	wms.is_be_delivery
	WHEN 0
	THEN '窝窝发货'
	WHEN 1
	THEN '商家发货'
	END description
	FROM
	jeehe_inventory_wms wms
	WHERE wms.wms_goods_id = #wmsGoodsId:VARCHAR#
	</select>
	  <!-- 更新物流商品选型库存可更新字段   -->	
    <!-- <update id="updateGoodsWmsSelection" parameterClass="com.tuan.inventory.dao.data.redis.GoodsSelectionDO" >
      update jeehe_inventory_selection
      <dynamic prepend="set" >
        <isNotNull prepend="," property="totalNumber">
			total_num = #totalNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="leftNumber">
			left_num = #leftNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="waterfloodVal">
			waterflood_val = #waterfloodVal:INTEGER#
		</isNotNull>
      </dynamic>
      where good_type_id = #goodTypeId:BIGINT#
    </update> -->
	
	
	
	   <!-- 物流商品选型库存调整可更新字段   -->	
    <update id="adjustGoodsWmsSelection" parameterClass="com.tuan.inventory.dao.data.GoodsWmsSelectionResult" >
      update jeehe_inventory_selection
      <dynamic prepend="set" >
        <isNotNull prepend="," property="totalNum">
			total_num = total_num + #totalNum:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="leftNum">
			left_num = left_num + #leftNum:INTEGER#
		</isNotNull>
      </dynamic>
      where good_type_id = #goodTypeId:BIGINT#
    </update>
	
	
	 <!-- 通过物流编码查询物流商品的库存  -->	
	<select id="selectGoodsInventoryWMS" resultMap="GoodsInventoryWMSResult"  parameterClass="java.lang.String">
	SELECT
	wms.id,
	wms.wms_goods_id,
	wms.goods_supplier,
	wms.goods_sname,
	wms.total_num,
	wms.left_num,
	wms.is_be_delivery

	FROM
	jeehe_goods_wms wms
	WHERE wms.wms_goods_id = #wmsGoodsId:VARCHAR#
	</select>
	
	 <!-- 通过物流编码查询是否物流商品  -->	
	<select id="selectIsOrNotGoodsWMS" resultMap="GoodsInventoryWMSResult"  parameterClass="java.lang.Long">

	SELECT
	wms.id,
	wms.wms_goods_id,
	wms.goods_supplier,
	wms.goods_sname,
	wms.total_num,
	wms.left_num,
	wms.is_be_delivery
	FROM
	jeehe_goods_attribute ga,jeehe_goods_wms wms where ga.goods_wms_id = wms.id
	AND
	ga.goods_id = #goodsId:BIGINT#
	</select>
	 
	   <!-- 更新物流商品可更新字段   -->	
    <update id="updateGoodsInventoryWMS" parameterClass="com.tuan.inventory.dao.data.redis.GoodsInventoryWMSDO" >
      update jeehe_inventory_wms
      <dynamic prepend="set" >
      <isNotNull prepend="," property="totalNumber">
			goods_supplier = #goodsSupplier:VARCHAR#
		</isNotNull>
		<isNotNull prepend="," property="totalNumber">
			goods_sname = #goodsName:VARCHAR#
		</isNotNull>
        <isNotNull prepend="," property="totalNumber">
			total_num = #totalNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="leftNumber">
			left_num = #leftNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="isBeDelivery">
			is_be_delivery = #isBeDelivery:INTEGER#
		</isNotNull>
      </dynamic>
      where wms_goods_id = #wmsGoodsId:VARCHAR# and is_be_delivery = #isBeDelivery:INTEGER#
    </update>
	 
	  <!-- 插入物流商品库存信息 -->
  	<insert id="insertGoodsInventoryWMS" parameterClass="com.tuan.inventory.dao.data.redis.GoodsInventoryWMSDO" >
    insert into jeehe_inventory_wms 
    (id,
    wms_goods_id,
    goods_supplier,
	goods_sname,
    total_num, 
    left_num, 
    is_be_delivery
   
   )
    values (
            #id:BIGINT#,
            #wmsGoodsId:VARCHAR#,
            #goodsSupplier:VARCHAR#,
            #goodsName:VARCHAR#,
            #totalNumber:INTEGER#,
            #leftNumber:INTEGER#,
            #isBeDelivery:INTEGER#
           
    		)
    		
     </insert>
     
       <!-- 更新商品分店库存可更新字段   -->	
    <update id="updateGoodsSuppliers" parameterClass="com.tuan.inventory.dao.data.redis.GoodsSuppliersDO" >
      update jeehe_inventory_suppliers
      <dynamic prepend="set" >
        <isNotNull prepend="," property="totalNumber">
			total_num = #totalNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="leftNumber">
			left_num = #leftNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="waterfloodVal">
			waterflood_val = #waterfloodVal:INTEGER#
		</isNotNull>
      </dynamic>
      where suppliers_id = #suppliersId:INTEGER#
    </update>
     
	  <!-- 插入商品分店库存信息 -->
  	<insert id="insertGoodsSuppliers" parameterClass="com.tuan.inventory.dao.data.redis.GoodsSuppliersDO" >
    insert into jeehe_inventory_suppliers 
    (id,
    goods_id,
    suppliers_id,
    total_num, 
    left_num, 
    limit_storage, 
    waterflood_val
   
   )
    values (
            #id:BIGINT#,
            #goodsId:BIGINT#,
            #suppliersId:INTEGER#,
            #totalNumber:INTEGER#,
            #leftNumber:INTEGER#,
            #limitStorage:INTEGER#,
            #waterfloodVal:INTEGER#
           
    		)
     </insert>
     
      <!-- 删除商品 分店库存信息 -->
  	<insert id="deleteGoodsSuppliers" parameterClass="java.lang.Long" >
     delete from jeehe_inventory_suppliers 
      where suppliers_id = #suppliersId:BIGINT#
     </insert>
     
      <!-- 更新商品选型库存可更新字段   -->	
    <update id="updateGoodsSelection" parameterClass="com.tuan.inventory.dao.data.redis.GoodsSelectionDO" >
      update jeehe_inventory_selection
      <dynamic prepend="set" >
       <isNotNull prepend="," property="suppliersId">
			suppliers_id = #suppliersId:BIGINT#
		</isNotNull>
       <isNotNull prepend="," property="suppliersId">
			good_type_id = #goodTypeId:INTEGER#
		</isNotNull>
        <isNotNull prepend="," property="totalNumber">
			total_num = #totalNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="leftNumber">
			left_num = #leftNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="waterfloodVal">
			waterflood_val = #waterfloodVal:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="suppliersSubId">
			suppliers_sub_id = #suppliersSubId:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="suppliersInventoryId">
			suppliers_inventory_id = #suppliersInventoryId:INTEGER#
		</isNotNull>
      </dynamic>
      where id = #id:INTEGER#
    </update>
     
	  <!-- 插入商品选型库存信息 -->
  	<insert id="insertGoodsSelection" parameterClass="com.tuan.inventory.dao.data.redis.GoodsSelectionDO" >
    insert into jeehe_inventory_selection 
    (id,
    goods_id,
    suppliers_id,
    good_type_id,
    total_num, 
    left_num, 
    limit_storage, 
    waterflood_val,
    suppliers_sub_id,
    suppliers_inventory_id
    
   )
    values (
            #id:BIGINT#,
            #goodsId:BIGINT#,
            #suppliersId:BIGINT#,
            #goodTypeId:INTEGER#,
            #totalNumber:INTEGER#,
            #leftNumber:INTEGER#,
            #limitStorage:INTEGER#,
            #waterfloodVal:INTEGER#,
            #suppliersSubId:INTEGER#,
            #suppliersInventoryId:INTEGER#
           
    		)
     </insert>
	 
	 
	  <!-- 删除商品 选型库存信息 -->
  	<insert id="deleteGoodsSelection" parameterClass="java.lang.Long" >
     delete from jeehe_inventory_selection 
      where id = #id:BIGINT#
     </insert>
	 
    <!-- 更新商品库存可更新字段   -->	
    <update id="updateGoodsInventory" parameterClass="com.tuan.inventory.dao.data.redis.GoodsInventoryDO" >
      update jeehe_inventory_attribute
      <dynamic prepend="set" >
        <isNotNull prepend="," property="totalNumber">
			total_num = #totalNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="leftNumber">
			left_num = #leftNumber:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="goodsSelectionIds">
			good_selection_ids = #goodsSelectionIds:VARCHAR#
		</isNotNull>
		<isNotNull prepend="," property="wmsId">
			goods_wms_id = #wmsId:BIGINT#
		</isNotNull>
		<isNotNull prepend="," property="waterfloodVal">
			waterflood_val = #waterfloodVal:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="limitStorage">
			limit_storage = #limitStorage:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="isAddGoodsSelection">
			add_goods_selection = #isAddGoodsSelection:INTEGER#
		</isNotNull>
		<isNotNull prepend="," property="isDirectConsumption">
			direct_consumption = #isDirectConsumption:INTEGER#
		</isNotNull>
      </dynamic>
      where goods_id = #goodsId:BIGINT#
    </update>
	 
	   <!-- 插入商品 库存信息 -->
  	<insert id="insertGoodsInventory" parameterClass="com.tuan.inventory.dao.data.redis.GoodsInventoryDO" >
    insert into jeehe_inventory_attribute 
    (
    goods_id, 
    goods_wms_id,
    good_selection_ids,
    total_num, 
    left_num, 
    limit_storage, 
    add_goods_selection,
    direct_consumption,
    waterflood_val
   )
    values (
            #goodsId:BIGINT#,
            #wmsId:BIGINT#,
            #goodsSelectionIds:VARCHAR#,
            #totalNumber:INTEGER#,
            #leftNumber:INTEGER#,
            #limitStorage:INTEGER#,
            #isAddGoodsSelection:INTEGER#,
            #isDirectConsumption:INTEGER#,
            #waterfloodVal:INTEGER#
    		)
     </insert>
  	
  	
  	 <!-- 删除商品 库存信息 -->
  	<insert id="deleteGoodsInventory" parameterClass="java.lang.Long" >
     delete from jeehe_inventory_attribute 
      where goods_id = #goodsId:BIGINT# 
     </insert>
  	
  <!-- 插入库存日志流水表信息 -->
  	<insert id="insertInventoryQueue" parameterClass="com.tuan.inventory.dao.data.redis.GoodsInventoryActionDO" >
    insert into jeehe_inventory_log 
    (id, 
    goods_id, 
    order_id, 
    user_id, 
    type, 
    item,
    create_time,
    inventory_vara,
    original_inventory,
    opt_type,
    content,
    system,
    client_ip,
    remark)
    values (#id:BIGINT#, 
            #goodsId:BIGINT#,
            #orderId:BIGINT#,
            #userId:BIGINT#,
            #businessType:VARCHAR#,
            #item:VARCHAR#,
            #createTime:INTEGER#,
    		#inventoryChange:VARCHAR#,
    		#originalInventory:VARCHAR#,
    		#actionType:VARCHAR#,
    		#content:VARCHAR#,
    		#clientName:VARCHAR#,
    		#clientIp:VARCHAR#,
    		#remark:VARCHAR#)
     </insert>
   
</sqlMap>